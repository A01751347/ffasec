import{c as z,x as T,u as D,r as o,j as e,X as A,y as B,z as L,L as w,B as U}from"./index-CoLLSTFM.js";import{F as C}from"./file-text-3hiu_sto.js";import{T as M}from"./triangle-alert-C4X_m0T0.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],R=z("Database",I);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],k=z("Upload",$),v=T.create({baseURL:"/api/upload",headers:{"Content-Type":"application/json"}}),E={checkStructure:async()=>{var l,r;try{return{success:!0,data:(await v.get("/check-structure")).data}}catch(a){return{success:!1,error:((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.error)||"Error al verificar estructura de la tabla"}}},setupTable:async()=>{var l,r;try{return{success:!0,data:(await v.post("/setup-table")).data}}catch(a){return{success:!1,error:((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.error)||"Error al configurar la tabla"}}},uploadCustomers:async(l,r)=>{var a,c;try{return{success:!0,data:(await v.post("/customers",l,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:r?t=>{const i=Math.round(t.loaded*100/t.total);r(i)}:void 0})).data}}catch(h){return{success:!1,error:((c=(a=h.response)==null?void 0:a.data)==null?void 0:c.error)||"Error al cargar el archivo"}}}},V=()=>{const{showNotification:l}=D(),[r,a]=o.useState(null),[c,h]=o.useState(!1),[t,i]=o.useState(null),[g,u]=o.useState(null),[b,p]=o.useState(null),[j,x]=o.useState(0),y=d=>{const s=d.target.files[0];if(!s)return;const f=s.name.split(".").pop().toLowerCase();if(f!=="xlsx"&&f!=="xls"){u("Por favor, selecciona un archivo Excel válido (.xlsx o .xls)"),a(null),p(null);return}u(null),i(null),a(s),p({name:s.name,size:n(s.size),type:s.type})},N=async()=>{if(!r){u("Por favor, selecciona un archivo primero");return}const d=new FormData;d.append("excelFile",r),h(!0),u(null),i(null),x(0);try{const s=await E.uploadCustomers(d,f=>x(f));if(s.success)i(s.data),a(null),p(null),l("Archivo procesado correctamente","success");else throw new Error(s.error||"Error al procesar el archivo")}catch(s){console.error("Error al subir archivo:",s),u(s.message||"Ocurrió un error al procesar el archivo"),l("Error al cargar el archivo: "+s.message,"error")}finally{h(!1),x(0)}},n=(d,s=2)=>{if(d===0)return"0 Bytes";const f=1024,F=s<0?0:s,P=["Bytes","KB","MB","GB","TB"],S=Math.floor(Math.log(d)/Math.log(f));return parseFloat((d/Math.pow(f,S)).toFixed(F))+" "+P[S]},m=()=>{a(null),p(null),i(null),u(null)};return e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl border border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[e.jsx(C,{className:"h-6 w-6 text-blue-400 mr-2"}),"Actualizar Clientes desde Excel"]}),e.jsxs("div",{className:"mb-6 bg-gray-700 p-4 rounded-lg text-gray-300",children:[e.jsx("h3",{className:"font-medium text-white mb-2",children:"Instrucciones:"}),e.jsx("p",{className:"mb-2",children:"Para actualizar la tabla de clientes, sube un archivo Excel con las siguientes columnas:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Nombre del cliente"}),e.jsx("li",{children:"Número de teléfono"}),e.jsx("li",{children:"ID del cliente"})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Nota: Los clientes existentes se actualizarán según su ID. Los clientes nuevos serán añadidos a la tabla."})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"customer-excel-file",className:`flex flex-col items-center justify-center w-full h-48 border-2 border-dashed rounded-lg cursor-pointer 
              ${g?"border-red-500 bg-red-900 bg-opacity-10":"border-gray-600 bg-gray-700 bg-opacity-30 hover:bg-gray-600"}`,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(k,{className:"w-10 h-10 mb-3 text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-400",children:[e.jsx("span",{className:"font-medium text-blue-400",children:"Haz click para seleccionar"})," o arrastra un archivo Excel"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Formatos soportados: XLSX, XLS"})]}),e.jsx("input",{id:"customer-excel-file",type:"file",accept:".xlsx,.xls",className:"hidden",onChange:y,disabled:c})]})})}),b&&e.jsx("div",{className:"mb-6 bg-blue-900 bg-opacity-20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"text-blue-400 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:b.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:b.size})]})]}),e.jsx("button",{className:"text-gray-400 hover:text-white",onClick:m,disabled:c,children:e.jsx(A,{size:20})})]})}),c&&j>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${j}%`}})}),e.jsxs("p",{className:"text-center text-sm text-gray-400 mt-1",children:["Procesando: ",j,"%"]})]}),g&&e.jsxs("div",{className:"mb-6 bg-red-900 bg-opacity-20 p-4 rounded-lg flex items-start",children:[e.jsx(B,{className:"text-red-400 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-300",children:g})]}),t&&e.jsx("div",{className:"mb-6 bg-green-900 bg-opacity-20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(L,{className:"text-green-400 mr-2 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-300 font-medium",children:"¡Archivo procesado correctamente!"}),e.jsx("p",{className:"text-gray-300 mt-1",children:"Resultados:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-gray-300",children:[e.jsxs("li",{children:["Clientes actualizados: ",t.updated||0]}),e.jsxs("li",{children:["Clientes añadidos: ",t.added||0]}),e.jsxs("li",{children:["Errores encontrados: ",t.errors||0]}),e.jsxs("li",{children:["Total procesados: ",t.total||0]})]}),t.errorDetails&&t.errorDetails.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-yellow-300",children:"Detalles de errores:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1 text-gray-400 text-sm",children:[t.errorDetails.slice(0,5).map((d,s)=>e.jsx("li",{children:d},s)),t.errorDetails.length>5&&e.jsxs("li",{children:["... y ",t.errorDetails.length-5," más"]})]})]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:N,disabled:!r||c,className:`
            flex items-center justify-center gap-2 px-6 py-2 rounded-lg shadow-lg
            ${!r||c?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white transition-colors"}
          `,children:c?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:18}),e.jsx("span",{children:"Subir y Procesar"})]})})})]})},K=()=>{const{showNotification:l}=D(),[r,a]=o.useState(null),[c,h]=o.useState(!0),[t,i]=o.useState(!1),[g,u]=o.useState(!1),[b,p]=o.useState(null),[j,x]=o.useState(null);o.useEffect(()=>{y()},[]);const y=async()=>{var n;try{h(!0),x(null);const m=await E.checkStructure();m.success?(a(m.data),i(!1)):(console.warn("Respuesta no OK de la API:",m.error),a(m.data),i(((n=m.data)==null?void 0:n.needsSetup)||!1))}catch(m){console.error("Error al verificar estructura de BD:",m),x("Error al comunicarse con el servidor. Verifica tu conexión."),l("Error al verificar la estructura de la base de datos","error")}finally{h(!1)}},N=async()=>{try{u(!0),x(null),p(null);const n=await E.setupTable();n.success?(p(n.data),i(!1),l("Tabla configurada correctamente","success"),await y()):(x(n.error||"No se pudo configurar la tabla"),p({success:!1,message:n.error}),l("Error al configurar la tabla: "+n.error,"error"))}catch(n){console.error("Error al configurar tabla:",n),x("Error al comunicarse con el servidor. Verifica tu conexión."),l("Error al configurar la tabla","error")}finally{u(!1)}};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Actualización de Clientes"}),e.jsx("p",{className:"text-gray-400",children:"Importa datos de clientes desde un archivo Excel"})]}),c&&e.jsx("div",{className:"flex justify-center my-12",children:e.jsx(w,{})}),j&&!c&&e.jsxs("div",{className:"bg-red-900 bg-opacity-50 text-white p-4 rounded-lg mb-6 flex items-start gap-2",children:[e.jsx(M,{className:"text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Error"}),e.jsx("p",{children:j})]})]}),t&&!c&&e.jsxs("div",{className:"bg-yellow-900 bg-opacity-50 text-white p-6 rounded-lg mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-3 flex items-center",children:[e.jsx(R,{className:"text-yellow-400 mr-2"}),"Configuración de base de datos requerida"]}),e.jsxs("p",{className:"mb-4",children:["Se necesita configurar la tabla de clientes antes de poder importar datos.",(r==null?void 0:r.error)&&e.jsx("span",{className:"block mt-2 text-yellow-300",children:r.error})]}),e.jsx("button",{onClick:N,disabled:g,className:`
              flex items-center px-4 py-2 rounded
              ${g?"bg-gray-600 text-gray-300 cursor-not-allowed":"bg-yellow-600 hover:bg-yellow-700 text-white"}
            `,children:g?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",className:"mr-2"}),"Configurando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2",size:18}),"Configurar tabla automáticamente"]})}),b&&e.jsx("div",{className:`mt-4 p-3 rounded ${b.success?"bg-green-900 bg-opacity-50":"bg-red-900 bg-opacity-50"}`,children:e.jsx("p",{children:b.message})})]}),!t&&!c&&e.jsx(V,{})]})};export{K as default};
