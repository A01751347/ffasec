import{c as C,u as A,r as o,j as e,m as l,L as z,D as _}from"./index-CoLLSTFM.js";import{H}from"./Header-x-afj402.js";import{S as M}from"./StatCard-CmT1tdfT.js";import{a as V,b as q,c as B,d as G}from"./useApi-CoBdRkS4.js";import{C as U}from"./CategoryChart-C2GrXGO0.js";import{P as O}from"./package-Dn0HgtBw.js";import{T as Y}from"./trending-up-BZmL-0eJ.js";import{T as W}from"./triangle-alert-C4X_m0T0.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],K=C("Filter",J);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],X=C("Plus",Q);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ee=C("RefreshCw",Z);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ae=C("SquarePen",te);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],re=C("Trash",se),ie=a=>a?a.substring(0,10):"",oe=()=>{var E;const{showNotification:a}=A(),[m,c]=o.useState(!1),[y,f]=o.useState(""),[F,u]=o.useState(!1),[d,j]=o.useState({ticket:"",date:"",name:"",telefono:""}),{data:S=[],isLoading:D,error:N,refetch:n}=V(),b=q(),p=B(),w=G(),g=async t=>{var r,i;t.preventDefault();try{if(!y||isNaN(parseInt(y,10))){a("Por favor, ingresa un número válido para el registro","error");return}const s=parseInt(y,10);console.log("Registro a agregar (valor numérico):",s);const h=await b.mutateAsync(s);let x="Registro agregado correctamente";h!=null&&h.telefono?x+=`. Teléfono del cliente: ${h.telefono}`:x+=". No se encontró teléfono del cliente.",a(x,"success"),f(""),c(!1)}catch(s){console.error("Error adding registro:",s),a(`Error al agregar el registro: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`,"error")}},P=async t=>{var r,i;if(window.confirm("¿Está seguro de eliminar este registro?"))try{await w.mutateAsync(t),a("Registro eliminado correctamente","success")}catch(s){console.error("Error deleting registro:",s),a(`Error al eliminar el registro: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`,"error")}},L=t=>{j({ticket:t.ticket,date:t.date||"",name:t.name||"",telefono:t.telefono||""}),u(!0)},v=t=>{const{name:r,value:i}=t.target;j(s=>({...s,[r]:i}))},k=async t=>{var r,i;t.preventDefault();try{await p.mutateAsync({ticket:d.ticket,telefono:d.telefono}),a("Registro actualizado correctamente","success"),u(!1)}catch(s){console.error("Error updating registro:",s),a(`Error al actualizar el registro: ${((i=(r=s.response)==null?void 0:r.data)==null?void 0:i.error)||s.message}`,"error")}};return e.jsxs(e.Fragment,{children:[e.jsxs(l.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl p-6 border border-gray-700 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Detalles de Inventario"}),e.jsxs("button",{onClick:()=>c(!m),className:"bg-blue-500 text-white px-4 py-2 rounded flex items-center gap-2",children:[e.jsx(X,{size:18}),"Agregar Registro"]})]}),m&&e.jsxs("form",{onSubmit:g,className:"mb-4 flex items-center gap-4",children:[e.jsx("input",{type:"number",value:y,onChange:t=>f(t.target.value),placeholder:"Ingrese el ticket (número)",className:"border border-gray-600 bg-gray-700 text-white p-2 rounded",required:!0}),e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded",disabled:b.isLoading,children:b.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),"Guardando..."]}):"Guardar"})]}),D&&e.jsx("div",{className:"flex justify-center items-center py-6",children:e.jsx(z,{})}),N&&e.jsxs("div",{className:"bg-red-900 bg-opacity-50 p-4 rounded-lg mb-4 text-white",children:[e.jsxs("p",{children:["Error al cargar detalles: ",N.message]}),e.jsx("button",{className:"mt-2 bg-red-700 px-3 py-1 rounded text-sm",onClick:()=>n(),children:"Reintentar"})]}),!D&&!N&&(S.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ticket"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Teléfono"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:S.map((t,r)=>e.jsxs(l.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-100",children:t.ticket}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-300",children:ie(t.date)}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-300",children:t.name}),e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-300",children:t.telefono||"-"}),e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-300 flex gap-2",children:[e.jsx("button",{className:"text-blue-400 hover:text-blue-300 transition-colors",onClick:()=>L(t),disabled:p.isLoading,children:e.jsx(ae,{size:18})}),e.jsx("button",{className:"text-red-400 hover:text-red-300 transition-colors",onClick:()=>P(t.ticket),disabled:w.isLoading,children:e.jsx(re,{size:18})})]})]},r))})]})}):e.jsx("p",{className:"text-gray-400 text-center py-6",children:"No hay registros de inventario para mostrar."}))]}),F&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs(l.div,{className:"bg-gray-800 p-6 rounded-xl shadow-lg w-96",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-100 mb-4",children:"Editar Registro"}),e.jsxs("form",{onSubmit:k,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-100 text-sm",children:"Ticket"}),e.jsx("input",{type:"number",name:"ticket",value:d.ticket,className:"border border-gray-600 bg-gray-700 text-white p-2 rounded",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-100 text-sm",children:"Fecha"}),e.jsx("input",{type:"date",name:"date",value:((E=d.date)==null?void 0:E.substring(0,10))||"",onChange:v,className:"border border-gray-600 bg-gray-700 text-white p-2 rounded",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-100 text-sm",children:"Cliente"}),e.jsx("input",{type:"text",name:"name",value:d.name||"",onChange:v,className:"border border-gray-600 bg-gray-700 text-white p-2 rounded",disabled:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-gray-100 text-sm",children:"Teléfono"}),e.jsx("input",{type:"text",name:"telefono",value:d.telefono||"",onChange:v,className:"border border-gray-600 bg-gray-700 text-white p-2 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"bg-gray-600 text-white px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"bg-green-500 text-white px-4 py-2 rounded",disabled:p.isLoading,children:p.isLoading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),"Guardando..."]}):"Guardar Cambios"})]})]})]})})]})};function T(a=""){return a?a.charAt(0).toUpperCase()+a.slice(1):""}function ne(a){if(a==null)return"$0.00";const m=typeof a=="string"?parseFloat(a):a;return isNaN(m)?"$0.00":`$${m.toFixed(2)}`}const ye=()=>{const[a,m]=o.useState(()=>{const t=new Date().getFullYear();return new Date(t,0,1).toISOString().split("T")[0]}),[c,y]=o.useState(()=>new Date().toISOString().split("T")[0]),[f,F]=o.useState(0),[u,d]=o.useState(""),[j,S]=o.useState(0),[D,N]=o.useState(""),[n,b]=o.useState(!0),[p,w]=o.useState(null),[g,P]=o.useState([]),[L,v]=o.useState([]),k=async()=>{b(!0),w(null);try{const t=await fetch(`/api/dashboardStats?from=${a}&to=${c}`);if(!t.ok)throw new Error("Error al cargar estadísticas");const r=await t.json();F(r.totalPiecesRange||0),S(r.totalSalesRange||0);const i=await fetch(`/api/categoryDistribution?from=${a}&to=${c}`);if(!i.ok)throw new Error("Error al cargar distribución de categorías");const s=await i.json();v(s),s&&s.length>0&&d(s[0].category);const h=await fetch(`/api/products?from=${a}&to=${c}`);if(!h.ok)throw new Error("Error al cargar productos");const x=await h.json();if(P(x),x&&x.length>0){const $=x.reduce((I,R)=>R.stock<I.stock?R:I);N($.name)}}catch(t){console.error("Error al cargar datos:",t),w(t.message||"Error al cargar datos")}finally{b(!1)}};o.useEffect(()=>{k()},[a,c]);const E=()=>{k()};return e.jsxs("div",{className:"flex-1 overflow-auto relative z-10",children:[e.jsx(H,{title:"Productos e Inventario"}),e.jsxs("main",{className:"max-w-7xl mx-auto py-6 px-4 lg:px-8 xl:px-12",children:[e.jsx(l.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl p-6 border border-gray-700 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-100 flex items-center",children:[e.jsx(K,{className:"mr-2",size:20}),"Filtros"]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Desde:"}),e.jsx("input",{type:"date",value:a,onChange:t=>m(t.target.value),className:"bg-gray-700 text-white border border-gray-600 rounded p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Hasta:"}),e.jsx("input",{type:"date",value:c,onChange:t=>y(t.target.value),className:"bg-gray-700 text-white border border-gray-600 rounded p-2"})]}),e.jsx("button",{onClick:E,className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded flex items-center",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cargando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2",size:16}),"Aplicar"]})})]})]})}),p&&e.jsxs(l.div,{className:"bg-red-800 bg-opacity-50 text-white p-4 rounded-lg mb-6",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[e.jsxs("p",{className:"font-medium",children:["Error: ",p]}),e.jsx("button",{onClick:k,className:"mt-2 bg-red-700 hover:bg-red-600 px-4 py-1 rounded text-sm",children:"Reintentar"})]}),e.jsxs(l.div,{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,staggerChildren:.1},children:[e.jsx(M,{name:"Prendas Totales",icon:O,value:f,color:"#6366f1",isLoading:n}),e.jsx(M,{name:"Más Popular",icon:Y,value:T(u),color:"#8B5CF6",isLoading:n}),e.jsx(M,{name:"Stock Bajo",icon:W,value:D||"No disponible",color:"#6366f1",isLoading:n}),e.jsx(M,{name:"Total Ventas",icon:_,type:"Money",value:j,color:"#8B5CF6",isLoading:n})]}),e.jsxs(l.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl p-6 border border-gray-700 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Lista de Productos"}),n?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):g&&g.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Nombre"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Piezas"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:g.slice(0,5).map((t,r)=>{let i=parseFloat(t.price);return isNaN(i)&&(i=0),e.jsxs(l.tr,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,delay:r*.05},children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-100",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.category}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:["$",i.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.stock}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:t.sales})]},r)})})]}),g.length>5&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("span",{className:"text-sm text-gray-400",children:["Mostrando 5 de ",g.length," productos"]})})]}):e.jsx("div",{className:"text-center text-gray-400 py-12",children:e.jsx("p",{children:"No hay productos disponibles para mostrar."})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs(l.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl p-6 border border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Distribución por Categorías"}),n?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx(U,{fromDate:a,toDate:c})]}),e.jsxs(l.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl p-6 border border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Tendencias de Ventas"}),n?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"text-center py-10",children:e.jsxs("div",{className:"bg-gray-700 bg-opacity-50 rounded-lg p-8",children:[e.jsx("div",{className:"text-4xl font-bold text-white mb-2",children:ne(j)}),e.jsx("p",{className:"text-gray-400",children:"Ventas totales en el período seleccionado"}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-center items-center text-sm",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:"Prendas procesadas:"}),e.jsx("span",{className:"font-medium text-white",children:f})]}),e.jsxs("div",{className:"flex justify-center items-center text-sm mt-2",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:"Categoría destacada:"}),e.jsx("span",{className:"font-medium text-white",children:T(u)})]})]})]})})]})]}),e.jsx(oe,{})]})]})};export{ye as default};
