import{c as _,j as e,m as j,D as k,r as l,F as T,X as P}from"./index-CoLLSTFM.js";import{H as O}from"./Header-x-afj402.js";import{C as z}from"./calendar-Dmtvk1k8.js";import{S as V}from"./search-CAGpUrik.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],H=_("Download",A);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],B=_("Eye",q),U=({sales:x,loading:m,error:i,onSaleClick:a,onRetry:y})=>{const g=s=>new Date(s).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return m?e.jsx("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl p-6 border border-gray-700",children:e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),e.jsx("p",{className:"ml-4 text-gray-300",children:"Cargando ventas..."})]})}):i?e.jsxs("div",{className:"bg-red-900 bg-opacity-50 rounded-xl p-6 text-center",children:[e.jsx("h3",{className:"text-xl text-red-400 mb-4",children:"Error al cargar ventas"}),e.jsx("p",{className:"text-gray-300 mb-4",children:i}),e.jsx("button",{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded",children:"Reintentar"})]}):!x||x.length===0?e.jsx("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl p-6 border border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No se encontraron ventas"})}):e.jsx(j.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl border border-gray-700 overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-700 bg-opacity-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Método de Pago"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:x.map((s,h)=>e.jsxs(j.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:h*.05},className:"hover:bg-gray-700 hover:bg-opacity-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:s.sale_id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:g(s.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:s.customer_name||"Cliente General"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`
                    px-2 py-1 rounded-full text-xs font-medium
                    ${s.payment_method==="cash"?"bg-green-500 text-white":"bg-blue-500 text-white"}
                  `,children:s.payment_method==="cash"?"Efectivo":"Tarjeta"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{size:16,className:"mr-1"}),parseFloat(s.total).toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("button",{onClick:()=>a(s),className:"text-blue-400 hover:text-blue-300 transition-colors",title:"Ver Detalles",children:e.jsx(B,{size:18})})})]},s.sale_id))})]})})})},X=({isOpen:x,sale:m,onClose:i})=>{const[a,y]=l.useState(null),[g,s]=l.useState(!1),[h,p]=l.useState(null);if(l.useEffect(()=>{(async()=>{if(!(!x||!m)){s(!0),p(null);try{const r=await fetch(`/api/sales/${m.sale_id}`);if(!r.ok)throw new Error("No se pudieron cargar los detalles de la venta");const n=await r.json();y(n)}catch(r){console.error("Error fetching sale details:",r),p(r.message)}finally{s(!1)}}})()},[x,m]),!x)return null;const d=t=>new Date(t).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return g?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-red-900 p-6 rounded-lg text-white",children:[e.jsx("p",{children:h}),e.jsx("button",{onClick:i,className:"mt-4 bg-red-700 px-4 py-2 rounded",children:"Cerrar"})]})}):a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs(j.div,{className:"bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center",children:[e.jsx(T,{className:"mr-2 text-blue-400",size:24}),"Detalle de Venta #",a.sale_id]}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(P,{size:24})})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Información de Venta"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-400",children:[e.jsx("strong",{className:"text-gray-300",children:"Fecha:"})," ",d(a.date)]}),e.jsxs("p",{className:"text-gray-400",children:[e.jsx("strong",{className:"text-gray-300",children:"Cliente:"})," ",a.customer_name||"Cliente General"]}),e.jsxs("p",{className:"text-gray-400 flex items-center",children:[e.jsx("strong",{className:"text-gray-300 mr-2",children:"Método de Pago:"}),e.jsx("span",{className:`
                  px-2 py-1 rounded-full text-xs font-medium
                  ${a.payment_method==="cash"?"bg-green-500 text-white":"bg-blue-500 text-white"}
                `,children:a.payment_method==="cash"?"Efectivo":"Tarjeta"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Resumen Financiero"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-400 flex items-center",children:[e.jsx(k,{className:"mr-2 text-green-400",size:20}),e.jsx("strong",{className:"text-gray-300 mr-2",children:"Total:"}),"$",parseFloat(a.total).toFixed(2)]}),a.payment_method==="cash"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-400",children:[e.jsx("strong",{className:"text-gray-300",children:"Efectivo Recibido:"}),"$",parseFloat(a.cash_received||0).toFixed(2)]}),e.jsxs("p",{className:"text-gray-400",children:[e.jsx("strong",{className:"text-gray-300",children:"Cambio:"}),"$",parseFloat(a.change_given||0).toFixed(2)]})]})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Productos Vendidos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-700 bg-opacity-50",children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs text-gray-400",children:"Producto"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs text-gray-400",children:"Categoría"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs text-gray-400",children:"Precio"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs text-gray-400",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs text-gray-400",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:a.items&&a.items.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-700 hover:bg-opacity-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-300",children:t.product_name}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-300",children:t.product_category||"Sin Categoría"}),e.jsxs("td",{className:"px-4 py-2 text-right text-sm text-green-400",children:["$",parseFloat(t.price).toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 text-right text-sm text-gray-300",children:t.quantity}),e.jsxs("td",{className:"px-4 py-2 text-right text-sm text-green-400",children:["$",(parseFloat(t.price)*t.quantity).toFixed(2)]})]},r))})]})})]})]})}):e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg text-white",children:[e.jsx("p",{children:"No se encontraron detalles de la venta"}),e.jsx("button",{onClick:i,className:"mt-4 bg-blue-700 px-4 py-2 rounded",children:"Cerrar"})]})})},G=({startDate:x,endDate:m,onDateChange:i})=>{const[a,y]=l.useState(x),[g,s]=l.useState(m),h=()=>{i(a,g)},p=d=>{const t=new Date;let r,n;switch(d){case"today":r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(t.getFullYear(),t.getMonth(),t.getDate());break;case"thisWeek":r=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+(6-t.getDay()));break;case"thisMonth":r=new Date(t.getFullYear(),t.getMonth(),1),n=new Date(t.getFullYear(),t.getMonth()+1,0);break;case"lastMonth":r=new Date(t.getFullYear(),t.getMonth()-1,1),n=new Date(t.getFullYear(),t.getMonth(),0);break;case"thisYear":r=new Date(t.getFullYear(),0,1),n=new Date(t.getFullYear(),11,31);break;default:r=new Date(t.getFullYear(),0,1),n=new Date(t.getFullYear(),11,31);return}y(r.toISOString().split("T")[0]),s(n.toISOString().split("T")[0]),i(r.toISOString().split("T")[0],n.toISOString().split("T")[0])};return e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsx("label",{className:"text-sm text-gray-400 whitespace-nowrap",children:"Desde:"}),e.jsx("input",{type:"date",value:a,onChange:d=>y(d.target.value),className:"bg-gray-700 text-white rounded px-2 py-1 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsx("label",{className:"text-sm text-gray-400 whitespace-nowrap",children:"Hasta:"}),e.jsx("input",{type:"date",value:g,onChange:d=>s(d.target.value),className:"bg-gray-700 text-white rounded px-2 py-1 w-full"})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("button",{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center gap-2",children:[e.jsx(z,{size:16}),"Aplicar"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{onChange:d=>p(d.target.value),className:"bg-gray-700 text-white rounded px-4 py-2 appearance-none",children:[e.jsx("option",{value:"",children:"Rápido"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"thisWeek",children:"Esta Semana"}),e.jsx("option",{value:"thisMonth",children:"Este Mes"}),e.jsx("option",{value:"lastMonth",children:"Mes Anterior"}),e.jsx("option",{value:"thisYear",children:"Este Año"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]})]})},Z=()=>{const[x,m]=l.useState([]),[i,a]=l.useState([]),[y,g]=l.useState(!0),[s,h]=l.useState(null),[p,d]=l.useState({startDate:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),[t,r]=l.useState(""),[n,I]=l.useState(null),[Y,F]=l.useState(!1),[w,$]=l.useState({totalSales:0,totalItems:0,averageTicket:0}),C=async()=>{g(!0);try{const{startDate:c,endDate:b}=p,v=new URLSearchParams({...c&&{startDate:c},...b&&{endDate:b},...t&&{customerName:t}}),f=await fetch(`/api/sales?${v}`);if(!f.ok)throw new Error("Error al cargar ventas");const o=await f.json();m(o),a(o);const N=o.reduce((D,S)=>D+parseFloat(S.total),0),u=o.reduce((D,S)=>{var E;return D+(((E=S.items)==null?void 0:E.length)||0)},0),M=N/o.length;$({totalSales:N,totalItems:u,averageTicket:isNaN(M)?0:M}),h(null)}catch(c){h(c.message),m([]),a([])}finally{g(!1)}};l.useEffect(()=>{C()},[p,t]);const R=c=>{I(c),F(!0)},L=()=>{const c=["ID de Venta","Fecha","Total","Método de Pago","Cliente"],b=i.map(u=>[u.sale_id,new Date(u.date).toLocaleDateString(),`$${parseFloat(u.total).toFixed(2)}`,u.payment_method,u.customer_name]),v=[c.join(","),...b.map(u=>u.join(","))].join(`
`),f=new Blob([v],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),N=URL.createObjectURL(f);o.setAttribute("href",N),o.setAttribute("download",`ventas_${new Date().toISOString().split("T")[0]}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)};return e.jsxs("div",{className:"flex-1 overflow-auto relative z-10",children:[e.jsx(O,{title:"Registro de Ventas"}),e.jsxs("main",{className:"max-w-7xl mx-auto py-6 px-4 lg:px-8 xl:px-12",children:[e.jsx(j.div,{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl p-6 border border-gray-700 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsx(G,{startDate:p.startDate,endDate:p.endDate,onDateChange:(c,b)=>d({startDate:c,endDate:b})}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(V,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",placeholder:"Buscar por cliente",value:t,onChange:c=>r(c.target.value),className:"w-full bg-gray-700 text-white placeholder-gray-400 rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("button",{onClick:L,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(H,{size:18}),"Exportar CSV"]})]})}),e.jsxs(j.div,{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl p-6 border border-gray-700 flex items-center",children:[e.jsx("div",{className:"bg-blue-500/20 rounded-full p-3 mr-4",children:e.jsx(k,{className:"text-blue-400",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total de Ventas"}),e.jsxs("h3",{className:"text-2xl font-bold text-white",children:["$",w.totalSales.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl p-6 border border-gray-700 flex items-center",children:[e.jsx("div",{className:"bg-green-500/20 rounded-full p-3 mr-4",children:e.jsx(T,{className:"text-green-400",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total de Items"}),e.jsx("h3",{className:"text-2xl font-bold text-white",children:w.totalItems})]})]}),e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md rounded-xl p-6 border border-gray-700 flex items-center",children:[e.jsx("div",{className:"bg-purple-500/20 rounded-full p-3 mr-4",children:e.jsx(z,{className:"text-purple-400",size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Ticket Promedio"}),e.jsxs("h3",{className:"text-2xl font-bold text-white",children:["$",w.averageTicket.toFixed(2)]})]})]})]}),e.jsx(U,{sales:i,loading:y,error:s,onSaleClick:R,onRetry:C}),n&&e.jsx(X,{isOpen:Y,sale:n,onClose:()=>F(!1)})]})]})};export{Z as default};
