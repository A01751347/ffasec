import{c as T,r as i,j as e,S as j,L as I,D as A}from"./index-CoLLSTFM.js";import{P as f}from"./package-Dn0HgtBw.js";import{C as b}from"./calendar-Dmtvk1k8.js";import{S}from"./search-CAGpUrik.js";import{F as L}from"./file-text-3hiu_sto.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],z=T("Clipboard",O);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],R=T("Clock",B),N=s=>s?new Date(s).toLocaleDateString():"",k=({type:s,title:l,message:c,icon:n})=>{const d={error:"bg-red-900 bg-opacity-50",info:"bg-blue-900 bg-opacity-50",warning:"bg-yellow-900 bg-opacity-50",success:"bg-green-900 bg-opacity-50"}[s]||"bg-blue-900 bg-opacity-50",u={error:"text-red-300",info:"text-blue-300",warning:"text-yellow-300",success:"text-green-300"}[s]||"text-blue-300";return e.jsxs("div",{className:`${d} rounded-lg p-6 text-center`,children:[n&&e.jsx(n,{className:`h-12 w-12 ${u} mx-auto mb-4`}),e.jsx("p",{className:`${u} text-lg font-medium`,children:l}),c&&e.jsx("p",{className:"text-gray-400 mt-2",children:c})]})},V=()=>{var $;const[s,l]=i.useState("ticket"),[c,n]=i.useState(""),[d,u]=i.useState(""),[r,y]=i.useState(null),[o,p]=i.useState(!1),[v,m]=i.useState(null),[C,F]=i.useState([]);i.useEffect(()=>{E()},[]);const E=async()=>{try{p(!0);const t=await fetch("/api/orders?page=1&limit=5");if(!t.ok)throw new Error(`Error al obtener órdenes recientes: ${t.status} ${t.statusText}`);const a=await t.json();a&&a.data&&Array.isArray(a.data)?F(a.data):(console.error("Formato de respuesta inesperado en órdenes recientes:",a),F([]))}catch(t){console.error("Error al obtener órdenes recientes:",t)}finally{p(!1)}},g=async()=>{if(s==="ticket"&&!c.trim()){m("Ingresa un número de ticket");return}if(s==="date"&&!d){m("Selecciona una fecha");return}if(s==="customer"&&!c.trim()){m("Ingresa el nombre del cliente");return}try{p(!0),m(null),y(null);let t;if(s==="ticket")t=await fetch(`/api/orders/${c.trim()}`);else if(s==="date")t=await fetch(`/api/orders/byDate?date=${d}`);else{const h=await fetch(`/api/customers?query=${encodeURIComponent(c.trim())}`);if(!h.ok)throw new Error(`Error al buscar clientes: ${h.status} ${h.statusText}`);const x=await h.json();if(!Array.isArray(x)||x.length===0){m("No se encontró ningún cliente con ese nombre"),p(!1);return}t=await fetch(`/api/orders/byCustomer/${x[0].id}`)}if(!t.ok)throw new Error(`Error al buscar orden: ${t.status} ${t.statusText}`);const a=await t.json();s==="ticket"?y(a):s==="date"?y({orders:Array.isArray(a)?a:[]}):s==="customer"&&y({customer:customers[0],orders:a.data||[]})}catch(t){console.error("Error en búsqueda:",t),m("Error al buscar: "+(t.message||"Error desconocido"))}finally{p(!1)}},D=t=>{t.key==="Enter"&&g()},P=t=>{if(!t)return{totalPrice:0,totalPieces:0};if(t.details&&Array.isArray(t.details)){const a=t.details.reduce((x,w)=>x+(parseFloat(w.price)||0),0),h=t.details.reduce((x,w)=>x+(parseInt(w.pieces,10)||0),0);return{totalPrice:a,totalPieces:h}}return t.total?{totalPrice:parseFloat(t.total||0),totalPieces:0}:{totalPrice:0,totalPieces:0}};return e.jsxs("div",{className:"p-6 max-w-7xl relative z-10 mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestión de Órdenes"}),e.jsx("p",{className:"text-gray-400",children:"Busca órdenes por ticket, fecha o cliente"})]}),e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl border border-gray-700 p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:"Buscar Órdenes"}),e.jsxs("div",{className:"flex flex-wrap mb-4 gap-2",children:[e.jsxs("button",{className:`px-4 py-2 rounded-lg flex items-center gap-2 ${s==="ticket"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,onClick:()=>l("ticket"),children:[e.jsx(f,{size:18}),e.jsx("span",{children:"Por Ticket"})]}),e.jsxs("button",{className:`px-4 py-2 rounded-lg flex items-center gap-2 ${s==="date"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,onClick:()=>l("date"),children:[e.jsx(b,{size:18}),e.jsx("span",{children:"Por Fecha"})]}),e.jsxs("button",{className:`px-4 py-2 rounded-lg flex items-center gap-2 ${s==="customer"?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,onClick:()=>l("customer"),children:[e.jsx(j,{size:18}),e.jsx("span",{children:"Por Cliente"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsx("div",{className:"relative flex-1",children:s==="date"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(b,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"date",value:d,onChange:t=>u(t.target.value),className:"w-full pl-10 py-2 px-4 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(S,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:c,onChange:t=>n(t.target.value),onKeyPress:D,placeholder:s==="ticket"?"Ingresa el número de ticket":"Ingresa el nombre del cliente",className:"w-full pl-10 py-2 px-4 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsx("button",{onClick:g,className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-lg",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Buscando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:18}),e.jsx("span",{children:"Buscar"})]})})]}),v&&!o&&e.jsxs("div",{className:"bg-red-900 bg-opacity-50 text-white p-4 rounded-lg mb-4 flex items-start gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:v})]})]}),o&&e.jsx("div",{className:"flex justify-center my-12",children:e.jsx(I,{})}),!o&&r&&e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl border border-gray-700 p-6 mb-8",children:[s==="ticket"&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[e.jsx(L,{className:"h-6 w-6 text-blue-400 mr-2"}),"Detalles de la Orden"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-medium text-white mb-3 flex items-center",children:[e.jsx(z,{className:"h-5 w-5 text-blue-400 mr-2"}),"Información General"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-300 flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Número de Orden:"}),e.jsx("span",{className:"font-medium",children:r.number})]}),e.jsxs("p",{className:"text-gray-300 flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Ticket:"}),e.jsx("span",{className:"font-medium",children:r.ticket})]}),e.jsxs("p",{className:"text-gray-300 flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Fecha:"}),e.jsx("span",{className:"font-medium",children:N(r.date)})]})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-lg font-medium text-white mb-3 flex items-center",children:[e.jsx(j,{className:"h-5 w-5 text-blue-400 mr-2"}),"Cliente"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-300 flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"ID Cliente:"}),e.jsx("span",{className:"font-medium",children:r.customerId})]}),e.jsxs("p",{className:"text-gray-300 flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Nombre:"}),e.jsx("span",{className:"font-medium",children:r.customerName})]})]})]})]}),r.details&&r.details.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-white mb-3 flex items-center",children:[e.jsx(f,{className:"h-5 w-5 text-blue-400 mr-2"}),"Detalles de la Orden"]}),e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-gray-900 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Proceso"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Piezas"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Precio"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:r.details.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.process}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.description}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100 text-center",children:t.pieces}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100 text-center",children:t.quantity}),e.jsxs("td",{className:"px-4 py-3 text-sm text-green-400 text-right font-medium",children:["$",parseFloat(t.price||0).toFixed(2)]})]},a))})]})}),e.jsx("div",{className:"mt-4 bg-blue-900 bg-opacity-30 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("p",{className:"text-blue-300 font-bold text-lg flex items-center",children:[e.jsx(A,{className:"h-5 w-5 mr-1"}),"Total Precio: $",P(r).totalPrice.toFixed(2)]}),e.jsxs("p",{className:"text-blue-300 font-bold text-lg flex items-center",children:[e.jsx(f,{className:"h-5 w-5 mr-1"}),"Total Piezas: ",P(r).totalPieces]})]})})]}):e.jsx(k,{type:"info",title:"No hay detalles disponibles",message:"Esta orden no tiene detalles registrados.",icon:f})]}),s==="date"&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[e.jsx(b,{className:"h-6 w-6 text-blue-400 mr-2"}),"Órdenes del ",N(d)]}),r.orders&&r.orders.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-gray-900 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ticket"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"ID Cliente"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:r.orders.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-800 transition-colors cursor-pointer",onClick:()=>{l("ticket"),n(t.ticket),g()},children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.ticket}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.id}),e.jsxs("td",{className:"px-4 py-3 text-sm text-green-400 text-right font-medium",children:["$",parseFloat(t.total||0).toFixed(2)]})]},a))})]})}):e.jsx(k,{type:"info",title:"No hay órdenes para esta fecha",message:"No se encontraron órdenes para la fecha seleccionada.",icon:b})]}),s==="customer"&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[e.jsx(j,{className:"h-6 w-6 text-blue-400 mr-2"}),"Órdenes de ",(($=r.customer)==null?void 0:$.name)||"Cliente"]}),r.orders&&r.orders.length>0?e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-gray-900 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ticket"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Fecha"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:r.orders.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-800 transition-colors cursor-pointer",onClick:()=>{l("ticket"),n(t.ticket),g()},children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.ticket}),e.jsxs("td",{className:"px-4 py-3 text-sm text-green-400 text-right font-medium",children:["$",parseFloat(t.total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:N(t.date)})]},a))})]})}):e.jsx(k,{type:"info",title:"No hay órdenes para este cliente",message:"El cliente seleccionado no tiene órdenes registradas.",icon:j})]})]}),!o&&!r&&C.length>0&&e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl border border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[e.jsx(R,{className:"h-6 w-6 text-blue-400 mr-2"}),"Órdenes Recientes"]}),e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-gray-900 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ticket"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Acción"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:C.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.ticket}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:t.name}),e.jsxs("td",{className:"px-4 py-3 text-sm text-green-400 text-right font-medium",children:["$",parseFloat(t.total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-100",children:N(t.date)}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs",onClick:()=>{l("ticket"),n(t.ticket),g()},children:"Ver Detalles"})})]},a))})]})})]})]})};export{V as default};
