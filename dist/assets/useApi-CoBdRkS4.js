import{_ as j,b as Q,n as q,i as k,d as L,t as H,f as J,e as _,h as $,s as X,k as Y,l as S,o as K,p as Z,R as p,q as ee,v as C,w as te,x as re}from"./index-CoLLSTFM.js";var se=function(r){j(i,r);function i(u,t){var e;return e=r.call(this)||this,e.client=u,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var s=i.prototype;return s.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},s.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),B(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},s.onUnsubscribe=function(){this.listeners.length||this.destroy()},s.shouldFetchOnReconnect=function(){return T(this.currentQuery,this.options,this.options.refetchOnReconnect)},s.shouldFetchOnWindowFocus=function(){return T(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},s.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},s.setOptions=function(t,e){var a=this.options,n=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=a.queryKey),this.updateQuery();var c=this.hasListeners();c&&N(this.currentQuery,n,this.options,a)&&this.executeFetch(),this.updateResult(e),c&&(this.currentQuery!==n||this.options.enabled!==a.enabled||this.options.staleTime!==a.staleTime)&&this.updateStaleTimeout();var o=this.computeRefetchInterval();c&&(this.currentQuery!==n||this.options.enabled!==a.enabled||o!==this.currentRefetchInterval)&&this.updateRefetchInterval(o)},s.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),a=this.client.getQueryCache().build(this.client,e);return this.createResult(a,e)},s.getCurrentResult=function(){return this.currentResult},s.trackResult=function(t,e){var a=this,n={},c=function(l){a.trackedProps.includes(l)||a.trackedProps.push(l)};return Object.keys(t).forEach(function(o){Object.defineProperty(n,o,{configurable:!1,enumerable:!0,get:function(){return c(o),t[o]}})}),(e.useErrorBoundary||e.suspense)&&c("error"),n},s.getNextResult=function(t){var e=this;return new Promise(function(a,n){var c=e.subscribe(function(o){o.isFetching||(c(),o.isError&&(t!=null&&t.throwOnError)?n(o.error):a(o))})})},s.getCurrentQuery=function(){return this.currentQuery},s.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},s.refetch=function(t){return this.fetch(Q({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},s.fetchOptimistic=function(t){var e=this,a=this.client.defaultQueryObserverOptions(t),n=this.client.getQueryCache().build(this.client,a);return n.fetch().then(function(){return e.createResult(n,a)})},s.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},s.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(q)),e},s.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(k||this.currentResult.isStale||!L(this.options.staleTime))){var e=H(this.currentResult.dataUpdatedAt,this.options.staleTime),a=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},a)}},s.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},s.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(k||this.options.enabled===!1||!L(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||J.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},s.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},s.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},s.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},s.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},s.createResult=function(t,e){var a=this.currentQuery,n=this.options,c=this.currentResult,o=this.currentResultState,l=this.currentResultOptions,d=t!==a,v=d?t.state:this.currentQueryInitialState,m=d?this.currentResult:this.previousQueryResult,h=t.state,g=h.dataUpdatedAt,P=h.error,x=h.errorUpdatedAt,I=h.isFetching,f=h.status,D=!1,w=!1,y;if(e.optimisticResults){var A=this.hasListeners(),V=!A&&B(t,e),z=A&&N(t,a,e,n);(V||z)&&(I=!0,g||(f="loading"))}if(e.keepPreviousData&&!h.dataUpdateCount&&(m!=null&&m.isSuccess)&&f!=="error")y=m.data,g=m.dataUpdatedAt,f=m.status,D=!0;else if(e.select&&typeof h.data<"u")if(c&&h.data===(o==null?void 0:o.data)&&e.select===this.selectFn)y=this.selectResult;else try{this.selectFn=e.select,y=e.select(h.data),e.structuralSharing!==!1&&(y=_(c==null?void 0:c.data,y)),this.selectResult=y,this.selectError=null}catch(O){$().error(O),this.selectError=O}else y=h.data;if(typeof e.placeholderData<"u"&&typeof y>"u"&&(f==="loading"||f==="idle")){var b;if(c!=null&&c.isPlaceholderData&&e.placeholderData===(l==null?void 0:l.placeholderData))b=c.data;else if(b=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof b<"u")try{b=e.select(b),e.structuralSharing!==!1&&(b=_(c==null?void 0:c.data,b)),this.selectError=null}catch(O){$().error(O),this.selectError=O}typeof b<"u"&&(f="success",y=b,w=!0)}this.selectError&&(P=this.selectError,y=this.selectResult,x=Date.now(),f="error");var G={status:f,isLoading:f==="loading",isSuccess:f==="success",isError:f==="error",isIdle:f==="idle",data:y,dataUpdatedAt:g,error:P,errorUpdatedAt:x,failureCount:h.fetchFailureCount,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>v.dataUpdateCount||h.errorUpdateCount>v.errorUpdateCount,isFetching:I,isRefetching:I&&f!=="loading",isLoadingError:f==="error"&&h.dataUpdatedAt===0,isPlaceholderData:w,isPreviousData:D,isRefetchError:f==="error"&&h.dataUpdatedAt!==0,isStale:U(t,e),refetch:this.refetch,remove:this.remove};return G},s.shouldNotifyListeners=function(t,e){if(!e)return!0;var a=this.options,n=a.notifyOnChangeProps,c=a.notifyOnChangePropsExclusions;if(!n&&!c||n==="tracked"&&!this.trackedProps.length)return!0;var o=n==="tracked"?this.trackedProps:n;return Object.keys(t).some(function(l){var d=l,v=t[d]!==e[d],m=o==null?void 0:o.some(function(g){return g===l}),h=c==null?void 0:c.some(function(g){return g===l});return v&&!h&&(!o||m)})},s.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!X(this.currentResult,e)){var a={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(a.listeners=!0),this.notify(Q({},a,t))}},s.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},s.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!Y(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},s.notify=function(t){var e=this;S.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(a){a(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},i}(K);function ne(r,i){return i.enabled!==!1&&!r.state.dataUpdatedAt&&!(r.state.status==="error"&&i.retryOnMount===!1)}function B(r,i){return ne(r,i)||r.state.dataUpdatedAt>0&&T(r,i,i.refetchOnMount)}function T(r,i,s){if(i.enabled!==!1){var u=typeof s=="function"?s(r):s;return u==="always"||u!==!1&&U(r,i)}return!1}function N(r,i,s,u){return s.enabled!==!1&&(r!==i||u.enabled===!1)&&(!s.suspense||r.state.status!=="error")&&U(r,s)}function U(r,i){return r.isStaleByTime(i.staleTime)}var ie=function(r){j(i,r);function i(u,t){var e;return e=r.call(this)||this,e.client=u,e.setOptions(t),e.bindMethods(),e.updateResult(),e}var s=i.prototype;return s.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},s.setOptions=function(t){this.options=this.client.defaultMutationOptions(t)},s.onUnsubscribe=function(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}},s.onMutationUpdate=function(t){this.updateResult();var e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)},s.getCurrentResult=function(){return this.currentResult},s.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},s.mutate=function(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,Q({},this.options,{variables:typeof t<"u"?t:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},s.updateResult=function(){var t=this.currentMutation?this.currentMutation.state:Z(),e=Q({},t,{isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=e},s.notify=function(t){var e=this;S.batch(function(){e.mutateOptions&&(t.onSuccess?(e.mutateOptions.onSuccess==null||e.mutateOptions.onSuccess(e.currentResult.data,e.currentResult.variables,e.currentResult.context),e.mutateOptions.onSettled==null||e.mutateOptions.onSettled(e.currentResult.data,null,e.currentResult.variables,e.currentResult.context)):t.onError&&(e.mutateOptions.onError==null||e.mutateOptions.onError(e.currentResult.error,e.currentResult.variables,e.currentResult.context),e.mutateOptions.onSettled==null||e.mutateOptions.onSettled(void 0,e.currentResult.error,e.currentResult.variables,e.currentResult.context))),t.listeners&&e.listeners.forEach(function(a){a(e.currentResult)})})},i}(K);function ue(){var r=!1;return{clearReset:function(){r=!1},reset:function(){r=!0},isReset:function(){return r}}}var ae=p.createContext(ue()),oe=function(){return p.useContext(ae)};function W(r,i,s){return typeof i=="function"?i.apply(void 0,s):typeof i=="boolean"?i:!!r}function M(r,i,s){var u=p.useRef(!1),t=p.useState(0),e=t[1],a=ee(r,i,s),n=C(),c=p.useRef();c.current?c.current.setOptions(a):c.current=new ie(n,a);var o=c.current.getCurrentResult();p.useEffect(function(){u.current=!0;var d=c.current.subscribe(S.batchCalls(function(){u.current&&e(function(v){return v+1})}));return function(){u.current=!1,d()}},[]);var l=p.useCallback(function(d,v){c.current.mutate(d,v).catch(q)},[]);if(o.error&&W(void 0,c.current.options.useErrorBoundary,[o.error]))throw o.error;return Q({},o,{mutate:l,mutateAsync:o.mutate})}function ce(r,i){var s=p.useRef(!1),u=p.useState(0),t=u[1],e=C(),a=oe(),n=e.defaultQueryObserverOptions(r);n.optimisticResults=!0,n.onError&&(n.onError=S.batchCalls(n.onError)),n.onSuccess&&(n.onSuccess=S.batchCalls(n.onSuccess)),n.onSettled&&(n.onSettled=S.batchCalls(n.onSettled)),n.suspense&&(typeof n.staleTime!="number"&&(n.staleTime=1e3),n.cacheTime===0&&(n.cacheTime=1)),(n.suspense||n.useErrorBoundary)&&(a.isReset()||(n.retryOnMount=!1));var c=p.useState(function(){return new i(e,n)}),o=c[0],l=o.getOptimisticResult(n);if(p.useEffect(function(){s.current=!0,a.clearReset();var d=o.subscribe(S.batchCalls(function(){s.current&&t(function(v){return v+1})}));return o.updateResult(),function(){s.current=!1,d()}},[a,o]),p.useEffect(function(){o.setOptions(n,{listeners:!1})},[n,o]),n.suspense&&l.isLoading)throw o.fetchOptimistic(n).then(function(d){var v=d.data;n.onSuccess==null||n.onSuccess(v),n.onSettled==null||n.onSettled(v,null)}).catch(function(d){a.clearReset(),n.onError==null||n.onError(d),n.onSettled==null||n.onSettled(void 0,d)});if(l.isError&&!a.isReset()&&!l.isFetching&&W(n.suspense,n.useErrorBoundary,[l.error,o.getCurrentQuery()]))throw l.error;return n.notifyOnChangeProps==="tracked"&&(l=o.trackResult(l,n)),l}function F(r,i,s){var u=te(r,i,s);return ce(u,se)}const R=re.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});R.interceptors.response.use(r=>r,r=>(r.response&&r.response.status===401&&console.error("Error de autenticación"),Promise.reject(r)));const E={getAll:()=>R.get("/inventario"),getDetails:()=>R.get("/inventario/details"),add:r=>(console.log("API enviando registro:",r,typeof r),R.post("/inventario",{registro:Number(r)}).then(i=>i.data)),update:(r,i)=>R.put(`/inventario/details/${r}`,{telefono:i}),remove:r=>R.delete(`/inventario/details/${r}`)},le={getStats:r=>R.get(`/dashboardStats?period=${r}`),getStatsWithRange:(r,i)=>R.get(`/dashboardStats?from=${r}&to=${i}`)},he={getOverview:()=>R.get("/salesOverview"),getCategoryDistribution:(r,i)=>R.get(`/categoryDistribution?from=${r}&to=${i}`)},fe=r=>F(["dashboardStats",r],()=>le.getStats(r).then(i=>i.data),{keepPreviousData:!0,staleTime:5*60*1e3}),ve=()=>F("inventoryDetails",()=>E.getDetails().then(r=>r.data)),pe=()=>{const r=C();return M(i=>E.add(i),{onSuccess:()=>{r.invalidateQueries("inventory"),r.invalidateQueries("inventoryDetails")}})},ye=()=>{const r=C();return M(({ticket:i,telefono:s})=>E.update(i,s),{onSuccess:()=>{r.invalidateQueries("inventoryDetails")}})},Re=()=>{const r=C();return M(i=>E.remove(i),{onSuccess:()=>{r.invalidateQueries("inventory"),r.invalidateQueries("inventoryDetails")}})},be=(r,i)=>F(["categoryDistribution",r,i],()=>he.getCategoryDistribution(r,i).then(s=>s.data),{keepPreviousData:!0,enabled:!!r&&!!i});export{ve as a,pe as b,ye as c,Re as d,be as e,fe as u};
