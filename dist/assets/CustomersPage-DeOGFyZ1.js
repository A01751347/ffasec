import{c as f,r as i,j as e,L as j}from"./index-CoLLSTFM.js";import{S as C}from"./search-CAGpUrik.js";import{F as E}from"./file-text-3hiu_sto.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],L=f("ChevronRight",S);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],h=f("User",F),$=a=>a?new Date(a).toLocaleDateString():"",D=()=>{const[a,u]=i.useState(""),[c,p]=i.useState([]),[o,w]=i.useState(null),[d,g]=i.useState([]),[n,x]=i.useState(!1),[b,r]=i.useState(null),y=async()=>{if(!a.trim()){r("Por favor, ingresa un término de búsqueda");return}try{x(!0),r(null),p([]);const s=await fetch(`/api/customers?query=${encodeURIComponent(a)}`);if(!s.ok)throw new Error(`Error en la búsqueda: ${s.status} ${s.statusText}`);const t=await s.json();Array.isArray(t)?(p(t),t.length===0&&r("No se encontraron clientes con ese nombre")):(console.error("Formato de respuesta inesperado:",t),r("Formato de respuesta inesperado"))}catch(s){console.error("Error buscando clientes:",s),r("Error al buscar clientes: "+(s.message||"Error desconocido"))}finally{x(!1)}},N=async s=>{try{x(!0),r(null),g([]);const t=await fetch(`/api/orders/byCustomer/${s}`);if(!t.ok)throw new Error(`Error al obtener órdenes: ${t.status} ${t.statusText}`);const l=await t.json();let m=[];l&&l.data&&Array.isArray(l.data)?m=l.data:Array.isArray(l)&&(m=l),g(m),m.length===0&&r("Este cliente no tiene órdenes registradas")}catch(t){console.error("Error al obtener órdenes:",t),r("Error al obtener órdenes: "+(t.message||"Error desconocido"))}finally{x(!1)}},v=s=>{w(s),N(s.id)},k=s=>{s.key==="Enter"&&y()};return e.jsxs("div",{className:"p-6 max-w-7xl relative z-10 mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestión de Clientes"}),e.jsx("p",{className:"text-gray-400",children:"Busca clientes y consulta su historial de órdenes"})]}),e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl border border-gray-700 p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:"Buscar Clientes"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(C,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:a,onChange:s=>u(s.target.value),onKeyPress:k,placeholder:"Ingresa nombre o apellido",className:"w-full pl-10 py-2 px-4 bg-gray-700 text-white border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("button",{onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg transition-colors flex items-center justify-center gap-2 shadow-lg",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),e.jsx("span",{children:"Buscando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{size:18}),e.jsx("span",{children:"Buscar"})]})})]}),n&&!c.length&&e.jsx("div",{className:"flex justify-center my-8",children:e.jsx(j,{})}),b&&!n&&e.jsxs("div",{className:"bg-red-900 bg-opacity-50 text-white p-4 rounded-lg mb-4 flex items-start gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:b})]}),!n&&c.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center",children:[e.jsx(h,{className:"mr-2 text-blue-400"}),"Resultados: ",c.length," cliente(s)"]}),e.jsx("div",{className:"bg-gray-700 rounded-lg overflow-hidden",children:e.jsx("ul",{className:"divide-y divide-gray-600",children:c.map(s=>e.jsx("li",{className:`transition-colors cursor-pointer ${(o==null?void 0:o.id)===s.id?"bg-blue-900 bg-opacity-40":"hover:bg-gray-600"}`,onClick:()=>v(s),children:e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-blue-800 rounded-full p-2 mr-3",children:e.jsx(h,{className:"h-5 w-5 text-blue-200"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium block",children:s.name||"Sin nombre"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["ID: ",s.id]})]})]}),e.jsx(L,{className:"h-5 w-5 text-gray-400"})]})},s.id))})})]})]}),o&&e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 backdrop-blur-md shadow-lg rounded-xl border border-gray-700 p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(E,{className:"h-6 w-6 text-blue-400 mr-2"}),"Órdenes de ",o.name||"Cliente"]}),d&&d.length>0?e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-300 mb-4",children:["Se encontraron ",d.length," órdene(s) para este cliente."]}),e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-gray-900 rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Número"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ticket"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Fecha"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:d.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-800 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-100",children:s.number}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-100",children:s.ticket}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-green-400 text-right font-medium",children:["$",parseFloat(s.total||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-100",children:$(s.date)})]},t))})]})})]}):n?e.jsx("div",{className:"flex justify-center my-6",children:e.jsx(j,{})}):e.jsxs("div",{className:"bg-blue-900 bg-opacity-30 rounded-lg p-6 text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-blue-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-blue-300 text-lg",children:"No se encontraron órdenes para este cliente."}),e.jsx("p",{className:"text-gray-400 mt-2",children:"El cliente seleccionado no tiene órdenes registradas en el sistema."})]})]})]})};export{D as default};
